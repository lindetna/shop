<model-bons-achats>
	<!-- début produits ajout -->
	<div class="bons_achats edit_bons_achats">
		<div class="general">
			<div class="cell_1">
				<input id="produit_id_categorie{ isEdit ? '_' + el.id : '' }" name="produit_id_categorie{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentCategorieId }">
				<input id="produit_id_activite{ isEdit ? '_' + el.id : '' }" name="produit_id_activite{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentActiviteId }">
				<input id="produit_id_modele{ isEdit ? '_' + el.id : '' }" name="produit_id_modele{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentModeleId }">
				<!--
				<div id="image_upload">
					<input type="file" value="choisir une image" id="produit_photo_upload{ isEdit ? '_' + el.id : '' }" class="image_upload photo_add pointer" onchange={readURL} />
					<div class="image_position">
		    			<img class="preview" src="#"/>
					</div>
					<button id="reset_image" onclick={resetImage}>X</button>
					<input class="hidden" type="text" name="produit_image_url{ isEdit ? '_' + el.id : '' }" id="produit_image_url{ isEdit ? '_' + el.id : '' }">
				</div>
				-->
			</div>
			<div class="cell_2">
				<p>
					<label for="produit_categorie{ isEdit ? '_' + el.id : '' }" class="xl-large">Catégorie</label>
					<input id="produit_categorie{ isEdit ? '_' + el.id : '' }" name="produit_categorie{ isEdit ? '_' + el.id : '' }" type="text" disabled="disabled" value="{ parentTag.currentCategorieLibelle }">
				</p>
				<p>
					<label for="produit_activite{ isEdit ? '_' + el.id : '' }" class="xl-large">Activité</label>
					<input id="produit_activite{ isEdit ? '_' + el.id : '' }" name="produit_activite{ isEdit ? '_' + el.id : '' }" type="text" disabled="disabled" value="{ parentTag.currentActiviteLibelle }">
				</p>
				<p>
					<label for="produit_libelle{ isEdit ? '_' + el.id : '' }" class="xl-large">Nom</label>
					<input id="produit_libelle{ isEdit ? '_' + el.id : '' }" name="produit_libelle{ isEdit ? '_' + el.id : '' }" class="" type="text" value="{ element.libelle }">
				</p>
			</div>
			<div class="cell_3">
				<input onclick={ parentTag.toggleVisible } type="image" class="produit_image_visible" src="/img/btn_{ element && element.visible == 'hidden' ? 'non' : '' }visible.png" title="visible" value="{ element && element.visible ? element.visible : 'visible' }" id="produit_visible{ isEdit ? '_' + el.id : '' }"  name="produit_visible{ isEdit ? '_' + el.id : '' }">
			</div>
		</div>
		<div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Informations
				</header>
				<div class="informations slide-up table">
					<div class="row">
						<div class="cell_1 blocInternet">
							<div class="block_infos" id="blocInfosInternet">
								<span class="block_title">Site internet CE</span>
								<div class="block_infos_content">
									<input type="checkbox" id="produit_information_internet{ isEdit ? '_' + el.id : '' }" name="produit_information_internet{ isEdit ? '_' + el.id : '' }" checked="{ element.information_internet ? 'checked' : '' }"> Information { element.libelle }
								</div>
							</div>
						</div>
						<div class="cell_2 ">
							<div class="lettre">
								<textarea name="produit_informations{ isEdit ? '_' + el.id : '' }" id="produit_informations{ isEdit ? '_' + el.id : '' }">{ element.informations }</textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Tarifs / Conditions
				</header>
				<div class="tarifs_conditions slide-up table">
					<div class="row">
						<div class="cell_1 bloc_tarif_condition">
							<div>
								<label for="produit_tarif{ isEdit ? '_' + el.id : '' }" class="bold">Tarif </label>
								<input type="text" class="l-large bold right" id="produit_tarif{ isEdit ? '_' + el.id : '' }" name="produit_tarif{ isEdit ? '_' + el.id : '' }" value="{ element.tarif }">
							</div>
							<div class="block_infos block_infos_1">
								<span class="block_title">
									<input type="checkbox" id="produit_conditions{ isEdit ? '_' + el.id : '' }" name="produit_conditions{ isEdit ? '_' + el.id : '' }" checked="{ element.conditions == 1 ? 'checked' : '' }"> <span>Condition</span>
								</span>
								<div class="block_infos_content">
									<div class="condition_billet">
										<label for="produit_limite_quantite{ isEdit ? '_' + el.id : '' }" class="limit_billet bold l-large">Limite de billets</label>
										<input class="right block_infos1_input" type="text" id="produit_limite_quantite{ isEdit ? '_' + el.id : '' }" name="produit_limite_quantite{ isEdit ? '_' + el.id : '' }" value="{ element.limite_quantite }">
										<select class="" id="produit_condition_quantite{ isEdit ? '_' + el.id : '' }" name="produit_condition_quantite{ isEdit ? '_' + el.id : '' }">
											<option value=""></option>
											<option value="mois" selected="{ element.condition_quantite == 'mois' ? 'selected' : false }">mois</option>
											<option value="trimestre" selected="{ element.condition_quantite == 'trimestre' ? 'selected' : false }">trimestre</option>
											<option value="semestre" selected="{ element.condition_quantite == 'semestre' ? 'selected' : false }">semestre</option>
											<option value="annee" selected="{ element.condition_quantite == 'annee' ? 'selected' : false }">année</option>
										</select>
									</div>
								</div>
								<div class="block_infos_content">
									<div class="condition_billet">
										<label for="produit_limite_montant{ isEdit ? '_' + el.id : '' }" class=" bold l-large">Limite de montant</label>
										<input class="right block_infos1_input" type="text" id="produit_limite_montant{ isEdit ? '_' + el.id : '' }" name="produit_limite_montant{ isEdit ? '_' + el.id : '' }" value="{ element.limite_montant }">
										<select class="" id="produit_condition_montant{ isEdit ? '_' + el.id : '' }" name="produit_condition_montant{ isEdit ? '_' + el.id : '' }">
											<option value=""></option>
											<option value="mois" selected="{ element.condition_montant == 'mois' ? 'selected' : false }">mois</option>
											<option value="trimestre" selected="{ element.condition_montant == 'trimestre' ? 'selected' : false }">trimestre</option>
											<option value="semestre" selected="{ element.condition_montant == 'semestre' ? 'selected' : false }">semestre</option>
											<option value="annee" selected="{ element.condition_montant == 'annee' ? 'selected' : false }">année</option>
										</select>
									</div>
								</div>
							</div>
							<div class="block_infos block_infos_2">
								<span class="block_title"><input type="checkbox" id="produit_participation{ isEdit ? '_' + el.id : '' }" name="produit_participation{ isEdit ? '_' + el.id : '' }" checked="{ element.participation ? 'checked' : '' }"> <span>Participation du CE</span></span>
								<div class="block_infos_content">
									<input type="radio" id="produit_type_participation{ isEdit ? '_' + el.id : '' }" name="produit_type_participation{ isEdit ? '_' + el.id : '' }" value="montant" checked="{ element.type_participation == 'montant' ? 'checked' : '' }">Montant
									<input type="radio" id="produit_type_participation_pourcentage{ isEdit ? '_' + el.id : '' }" name="produit_type_participation{ isEdit ? '_' + el.id : '' }" value="pourcentage" checked="{ element.type_participation == 'pourcentage' ? 'checked' : '' }">%
									<input class="input_montant right" type="text" id="produit_montant_participation{ isEdit ? '_' + el.id : '' }" name="produit_montant_participation{ isEdit ? '_' + el.id : '' }" value="{ element.montant_participation }">
								</div>
							</div>
						</div>
						<div class="cell_2 block_conditions_commande">
							<div class="block_infos block_infos_1">
								<span class="block_title">
										<input type="checkbox" id="produit_conditions_commande{ isEdit ? '_' + el.id : '' }" name="produit_conditions_commande{ isEdit ? '_' + el.id : '' }" checked="{ element.conditions_commande == 1 ? 'checked' : '' }"> <span>Condition commande</span>
								</span>
								<div class="block_infos_content">
									<div class="condition_billet">
										<label for="produit_limite_commande{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Limite de billets</label>
										<input class="right block_infos2_condition" type="text" id="produit_limite_commande{ isEdit ? '_' + el.id : '' }" name="produit_limite_commande{ isEdit ? '_' + el.id : '' }" value="{ element.limite_commande }">
										<select class="" id="produit_condition_commande{ isEdit ? '_' + el.id : '' }" name="produit_condition_commande{ isEdit ? '_' + el.id : '' }">
											<option value=""></option>
											<option value="mois" selected="{ element.condition_commande == 'mois' ? 'selected' : false }">mois</option>
											<option value="trimestre" selected="{ element.condition_commande == 'trimestre' ? 'selected' : false }">trimestre</option>
											<option value="semestre" selected="{ element.condition_commande == 'semestre' ? 'selected' : false }">semestre</option>
											<option value="annee" selected="{ element.condition_commande == 'annee' ? 'selected' : false }">année</option>
										</select>
									</div>
								</div>
							</div>
	<!--
							<div class="block_infos_block_infos_2">
								<span class="block_title">
										<input type="checkbox" id="produit_conditions{ isEdit ? '_' + el.id : '' }" name="produit_conditions{ isEdit ? '_' + el.id : '' }" checked="{ element.conditions ? 'checked' : '' }"> <span>Condition</span>
								</span>
								<div class="block_infos_content">
									<div class="condition_billet">
										<label for="produit_limite_billets{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Limite de billets 3</label>
										<input class="right block_infos2_condition" type="text" id="produit_limite_billets{ isEdit ? '_' + el.id : '' }" name="produit_limite_billets{ isEdit ? '_' + el.id : '' }" value="{ element.limite_billets }">
									</div>
									<div class="condition_periode">
										<label for="produit_condition{ isEdit ? '_' + el.id : '' }" class=" bold">Condition</label>
										<select class="" id="produit_condition{ isEdit ? '_' + el.id : '' }" name="produit_condition{ isEdit ? '_' + el.id : '' }">
											<option value=""></option>
											<option value="mois" selected="{ element.condition == 'mois' ? 'selected' : false }">mois</option>
											<option value="trimestre" selected="{ element.condition == 'trimestre' ? 'selected' : false }">trimestre</option>
											<option value="semestre" selected="{ element.condition == 'semestre' ? 'selected' : false }">semestre</option>
											<option value="annee" selected="{ element.condition == 'annee' ? 'selected' : false }">année</option>
										</select>
									</div>
								</div>
							</div>
	-->
						</div>
						<div class="cell_3">
							<div class="block_infos block_infos_1">
								<span class="block_title">
										<input type="checkbox" id="produit_stock{ isEdit ? '_' + el.id : '' }" name="produit_stock{ isEdit ? '_' + el.id : '' }" checked="{ element.stock == 1 ? 'checked' : '' }"> <span>Stocks</span>
								</span>
								<div class="block_infos_content">
									<div class="condition_billet">
										<label for="produit_nombre_billets{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Nombre de Billets</label>
										<input class="right block_infos2_condition" type="text" id="produit_nombre_billets{ isEdit ? '_' + el.id : '' }" name="produit_nombre_billets{ isEdit ? '_' + el.id : '' }" value="{ element.nombre_billets }">
									</div>
									<div class="condition_billet">
										<label for="produit_stock_restant{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Stocks Restant</label>
										<input class="right block_infos2_condition" type="text" id="produit_stock_restant{ isEdit ? '_' + el.id : '' }" name="produit_stock_restant{ isEdit ? '_' + el.id : '' }" value="{ element.stock_restant }">
									</div>
									<div class="condition_billet">
										<label class="produit_is"><input type="checkbox" id="produit_is_stock_permanence{ isEdit ? '_' + el.id : '' }" name="produit_is_stock_permanence{ isEdit ? '_' + el.id : '' }" checked="{ element.stock_permanence ? 'checked' : '' }"></label>
										<label for="produit_stock_permanence{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Stocks Permanence</label>
										<input class="right block_infos2_condition" type="text" id="produit_stock_permanence{ isEdit ? '_' + el.id : '' }" name="produit_stock_permanence{ isEdit ? '_' + el.id : '' }" value="{ element.stock_permanence }">
									</div>
									<div class="condition_billet">
										<label for="produit_stock_vendu{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Stocks Vendu</label>
										<input class="right block_infos2_condition" type="text" id="produit_stock_vendu{ isEdit ? '_' + el.id : '' }" name="produit_stock_vendu{ isEdit ? '_' + el.id : '' }" value="{ element.stock_vendu }">
									</div>
									<div class="condition_billet">
										<label for="produit_stock_alerte{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Stocks d'alerte</label>
										<input class="right block_infos2_condition" type="text" id="produit_stock_alerte{ isEdit ? '_' + el.id : '' }" name="produit_stock_alerte{ isEdit ? '_' + el.id : '' }" value="{ element.stock_alerte }">
									</div>
									<div class="condition_billet">
										<label class="produit_is"><input type="checkbox" id="produit_is_alerte_permanence{ isEdit ? '_' + el.id : '' }" name="produit_is_alerte_permanence{ isEdit ? '_' + el.id : '' }" checked="{ element.alerte_permanence ? 'checked' : '' }"></label>
										<label for="produit_alerte_permanence{ isEdit ? '_' + el.id : '' }" class="limit_billet bold stock_alerte_permanence">Stocks d'alerte permanence</label>
										<input class="right block_infos2_condition bloc_permenance" type="text" id="produit_alerte_permanence{ isEdit ? '_' + el.id : '' }" name="produit_alerte_permanence{ isEdit ? '_' + el.id : '' }" value="{ element.alerte_permanence }">
									</div>
									<div class="condition_billet">
										<label for="produit_date_validite{ isEdit ? '_' + el.id : '' }" class="limit_billet bold">Date de Validité</label>
										<input type="hidden" name="produit_date_validite{ isEdit ? '_' + el.id : '' }" id="produit_date_validite{ isEdit ? '_' + el.id : '' }" value="{ isEdit ? el.date_validite : '' }">
										<input class="right block_infos2_condition" type="text" id="front_produit_date_validite{ isEdit ? '_' + el.id : '' }" placeholder="jj/mm/aaaa" maxlength="10" field-for-date="produit_date_validite{ isEdit ? '_' + el.id : '' }" value="{ isEdit ? parentTag.convertDateToView(el.date_validite) : '' }" required="required" onchange={ formatDateField }>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Formule
				</header>
				<div class="comptabilite Informations slide-up table">
					<div class="table Information_colonne">
						<div class="row">
							<div class="participation_salarie">
								<input type="checkbox" id-to-disable="produit_formule_participation_salarie{ isEdit ? '_' + el.id : '' }" id="produit_is_formule_participation_salarie{ isEdit ? '_' + el.id : '' }" name="produit_is_formule_participation_salarie{ isEdit ? '_' + el.id : '' }" checked="{ element.formule_participation_salarie ? 'checked' : '' }" class="Information_cheick" onclick="{ disableElementById }"><label>Participation Salarié</label><br>
								<textarea class="" id="produit_formule_participation_salarie{ isEdit ? '_' + el.id : '' }" name="produit_formule_participation_salarie{ isEdit ? '_' + el.id : '' }">{ element.formule_participation_salarie }</textarea>
							</div>
						</div>
					</div>
				</div>
				<div class="comptabilite Informations slide-up table">

					<div class="table Information_colonne">
						<div class="row">
							<div class="participation_salarie">
								<input type="checkbox" id-to-disable="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }" id="produit_is_formule_participation_ce{ isEdit ? '_' + el.id : '' }" name="produit_is_formule_participation_ce{ isEdit ? '_' + el.id : '' }" checked="{ element.formule_participation_ce ? 'checked' : '' }" class="Information_cheick" onclick="{ disableElementById }"><label>Participation CE</label><br>
								<textarea class="" id="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }" name="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }">{ element.formule_participation_ce }</textarea>
							</div>
						</div>
					</div>
				</div>
				<div class="comptabilite Informations slide-up table">
					<div class="table Information_colonne">
						<div class="row">
							<div class="participation_salarie">
								<input type="checkbox" id-to-disable="produit_formule_condition{ isEdit ? '_' + el.id : '' }" id="produit_is_formule_condition{ isEdit ? '_' + el.id : '' }" name="produit_is_formule_condition{ isEdit ? '_' + el.id : '' }" checked="{ element.formule_condition ? 'checked' : '' }" class="Information_cheick" onclick="{ disableElementById }"><label>Conditions</label><br>
								<textarea class="" id="produit_formule_condition{ isEdit ? '_' + el.id : '' }" name="produit_formule_condition{ isEdit ? '_' + el.id : '' }">{ element.formule_condition }</textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Barème
				</header>
				<div class="bareme slide-up table">
					<div class="table bareme_colonne">
						<div class="row">
							<div class="right_block_lettres">
								<select class="select_right_block_lettres" id="produit_option_salarie{ isEdit ? '_' + el.id : '' }"  name="produit_option_salarie{ isEdit ? '_' + el.id : '' }" onchange={ filterChange }>
								<option></option>
									<option value="quotient">Quotient</option>
									<option value="tranche_salaire">Tranche sur salaire</option>
									<option value="statut">Statut</option>
									<option value="cl1">CL1</option>
									<option value="cl2">CL2</option>
									<option value="cl3">CL3</option>
									<option value="cl4">CL4</option>
									<option value="cl5">CL5</option>
									<option value="cl6">Cl6</option>
									<option value="cl7">CL7</option>
									<option value="cl8">CL8</option>
									<option value="cl9">CL9</option>
									<option value="cl10">CL10</option>
								</select>
							</div>
							<div class="bloc_bareme_deuxieme">
								<div class="bloc_tranche_salaire_quotient">
									<p class="quotient">Quotient</p>
									<p class="tranche_salaire">Tranche sur salaire</p>
									<p class="statut">Statut</p>
									<p class="cl1">Cl1</p>
									<p class="cl2">Cl2</p>
									<p class="cl3">Cl3</p>
									<p class="cl4">Cl4</p>
									<p class="cl5">Cl5</p>
									<p class="cl6">Cl6</p>
									<p class="cl7">Cl7</p>
									<p class="cl8">Cl8</p>
									<p class="cl9">Cl9</p>
									<p class="cl10">Cl10</p>
								</div>
								<button class="ajoute_bouton">Ajouter une ligne</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Comptabilité
				</header>
				<div class="comptabilite slide-up table">
					<div class="table">
						<div class="row">
							<div class="cell_1">
								<div>
									<label for="produit_id_compte{ isEdit ? '_' + el.id : '' }" class="bold">Comptes </label>
									<select id="produit_id_compte{ isEdit ? '_' + el.id : '' }" name="produit_id_compte{ isEdit ? '_' + el.id : '' }">
										<option value="">-----------------</option>
										<option each={ comptes } value={ id } selected={ id == element.id_compte ? 'selected' : '' }>{ reference } - { libelle }</option>
									</select>
								</div>
								<div>
									<label for="produit_id_analytique{ isEdit ? '_' + el.id : '' }" class="bold">Analytique </label>
									<select id="produit_id_analytique{ isEdit ? '_' + el.id : '' }" name="produit_id_analytique{ isEdit ? '_' + el.id : '' }">
										<option value="">-----------------</option>
										<option each={ analytiques } value={ id } selected={ id == element.id_analytique ? 'selected' : '' }>{ libelle }</option>
									</select>
								</div>
								<div>
									<label for="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }" class="bold">Comptes de stock </label>
									<select id="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }" name="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }">
										<option value="">-----------------</option>
										<option each={ comptes } value={ id } selected={ id == element.id_compte_stock ? 'selected' : '' }>{ reference } - { libelle }</option>
									</select>
								</div>
							</div>
							<div class="cell_2">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Questions
				</header>
				<div class="questions question_table slide-up table">
					<div class="table table_questions_categorie_activite">
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_1" name="produit_is_question_1" checked="{ element.question_1 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_1{ isEdit ? '_' + el.id : '' }" name="produit_question_1{ isEdit ? '_' + el.id : '' }" value="{ element.question_1 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_2" name="produit_is_question_2" checked="{ element.question_2 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_2{ isEdit ? '_' + el.id : '' }" name="produit_question_2{ isEdit ? '_' + el.id : '' }" value="{ element.question_2 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_3" name="produit_is_question_3" checked="{ element.question_3 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_3{ isEdit ? '_' + el.id : '' }" name="produit_question_3{ isEdit ? '_' + el.id : '' }" value="{ element.question_3 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_4" name="produit_is_question_4" checked="{ element.question_4 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_4{ isEdit ? '_' + el.id : '' }" name="produit_question_4{ isEdit ? '_' + el.id : '' }" value="{ element.question_4 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_5" name="produit_is_question_5" checked="{ element.question_5 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_5{ isEdit ? '_' + el.id : '' }" name="produit_question_5{ isEdit ? '_' + el.id : '' }" value="{ element.question_5 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_6" name="produit_is_question_6" checked="{ element.question_6 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_6{ isEdit ? '_' + el.id : '' }" name="produit_question_6{ isEdit ? '_' + el.id : '' }" value="{ element.question_6 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_7" name="produit_is_question_7" checked="{ element.question_7 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_7{ isEdit ? '_' + el.id : '' }" name="produit_question_7{ isEdit ? '_' + el.id : '' }" value="{ element.question_7 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_8" name="produit_is_question_8" checked="{ element.question_8 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_8{ isEdit ? '_' + el.id : '' }" name="produit_question_8{ isEdit ? '_' + el.id : '' }" value="{ element.question_8 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_9" name="produit_is_question_9" checked="{ element.question_9 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_9{ isEdit ? '_' + el.id : '' }" name="produit_question_9{ isEdit ? '_' + el.id : '' }" value="{ element.question_9 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_10" name="produit_is_question_10" checked="{ element.question_10 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_10{ isEdit ? '_' + el.id : '' }" name="produit_question_10{ isEdit ? '_' + el.id : '' }" value="{ element.question_10 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_11" name="produit_is_question_11" checked="{ element.question_11 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_11{ isEdit ? '_' + el.id : '' }" name="produit_question_11{ isEdit ? '_' + el.id : '' }" value="{ element.question_11 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_12" name="produit_is_question_12" checked="{ element.question_12 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_12{ isEdit ? '_' + el.id : '' }" name="produit_question_12{ isEdit ? '_' + el.id : '' }" value="{ element.question_12 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_13" name="produit_is_question_13" checked="{ element.question_13 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_13{ isEdit ? '_' + el.id : '' }" name="produit_question_13{ isEdit ? '_' + el.id : '' }" value="{ element.question_13 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_14" name="produit_is_question_14" checked="{ element.question_14 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_14{ isEdit ? '_' + el.id : '' }" name="produit_question_14{ isEdit ? '_' + el.id : '' }" value="{ element.question_14 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_15" name="produit_is_question_15" checked="{ element.question_15 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_15{ isEdit ? '_' + el.id : '' }" name="produit_question_15{ isEdit ? '_' + el.id : '' }" value="{ element.question_15 }">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Lettres
				</header>
				<div class="lettres categorie_table_lettres_activite slide-up table">
					<div class="left_right_lettres">
						<div class="left_block_lettres">
							<div class="titre_lettres">
								<span>Lettre</span>
								<div class="lettres_left_categ_act">
									<input type="checkbox" id="produit_gestion_lettre{ isEdit ? '_' + el.id : '' }" name="produit_gestion_lettre{ isEdit ? '_' + el.id : '' }" checked="{ element.gestion_lettre ? 'checked' : '' }">Gestion Lettre
									<input type="checkbox" id="produit_impression_automatique{ isEdit ? '_' + el.id : '' }" name="produit_impression_automatique{ isEdit ? '_' + el.id : '' }" checked="{ element.impression_automatique ? 'checked' : '' }">Impression Automatique
								</div>
							</div>
						</div>
						<div class="right_block_lettres">
							<select class="select_right_block_lettres" id="produit_lettre_fields{ isEdit ? '_' + el.id : '' }" name="produit_lettre_fields{ isEdit ? '_' + el.id : '' }">
								<option value="numero_salarie">N° { IS_CE ? 'Salarié' : 'Adhérent' }</option>
								<option value="titre">TItre</option>
								<option value="nom">Nom</option>
								<option value="prenom">Prénom</option>
								<option value="voie">N° et Voie</option>
								<option value="appartement_etage">N° Appartement ou Etage</option>
								<option value="entree_batiment">Entrée, Batiment</option>
								<option value="boite_postale">Lieu Dit, Boite Postale</option>
								<option value="code_postal">Code Postal</option>
								<option value="ville">Ville</option>
								<option value="pays">Pays</option>
								<option value="nom_naissance">Nom de Naissance</option>
								<option value="date_naissance">Date de Naissance</option>
								<option value="situation_familiale">Situation Familiale</option>
								<option value="tel">Téléphone</option>
								<option value="portable">Portable</option>
								<option value="email_perso">E-mail Personnel</option>
								<option value="email_pro">E-mail Professionel</option>
								<option value="id_internet">Identifiant Internet</option>
								<option value="pass">Mot de Passe</option>
								<option value="option_1">Option 1</option>
								<option value="option_2">Option 2</option>
							</select>
						</div>
					</div>
					<div class="lettre">
						<textarea class="lettre_texterea" id="produit_lettre{ isEdit ? '_' + el.id : '' }" name="produit_lettre{ isEdit ? '_' + el.id : '' }">{ element.lettre }</textarea>
					</div>
				</div>
			</div>
		</div>
		<div class="save_produit">
			<button class="button annuler cancel_submit" onclick={ cancelProduit }>Annuler</button> 
			<button class="button enregistrer save_submit" onclick={ saveProduit }>Enregistrer</button>
		</div>
	</div>
	<script>
		var _this = this;
		var app = opts.app;
		this.app = opts.app;
		this.parentTag = opts.parentTag;
		this.el = this.element = opts.element;
		this.loaded = false;
		var permissions = app.session.permissions;
		var ACTIVITES_READ = this.ACTIVITES_READ = permissions.ACTIVITES_READ || false;
		var IS_CE = this.IS_CE = permissions.IS_CE || false;
		var IS_ASSO = this.IS_ASSO = permissions.IS_ASSO || false;
		var element = this.el = this.element = opts.element;
		var isEdit = this.isEdit = false;

		if(opts.element){
			isEdit = this.isEdit = true;
		}else{
			element = this.el = this.element = {};
		}


		this.cell = {};

		this.comptes = [];
		this.idComptes = {};

		showContents(e){
			e.preventDefault();
			e.preventUpdate = true;
			e.stopPropagation();
            if(_this.parentTag.E_M){
                _this.parentTag.E_M.showContents(e, { toggleClass: 'hidden', });
            }
		}

		function getComptes(){
			var getParams = { type_element: 'compte' };
			if(document.getElementById('id_exercice')){
				getParams.id_exercice = document.getElementById('id_exercice').value;
			}
			getParams.visible = 'visible';
			$.getJSON( '/admin/compta/comptes', getParams, function(data){
				if(data && data.elements){
					var l = data.elements.length;
					var i, d; 
					var fields = {id: 'id', id_sous_classe: 'id_sous_classe', reference: 'reference', libelle: 'libelle', id_bilan_debit: 'id_bilan_debit', id_bilan_credit: 'id_bilan_credit', categorie_bilan_debit: 'categorie_bilan_debit', categorie_bilan_credit: 'categorie_bilan_credit', id_compte_resultat: 'id_compte_resultat', visible: 'visible',};
					var invisible_nb = 0;
					for(i=0; i<l; i++){
						if(data.elements[i]['visible'] === 'visible') {
							d = new Object();

							for(field in fields){
								d[fields[field]] = data.elements[i][field];
							}
							_this.idComptes[d['id']] = i - invisible_nb;
							_this.comptes.push(d);
						} else {
							invisible_nb += 1;
						}
					}
					//_this.numToLoad--;
					_this.update();
				}else{
					// TODO: no data elements, get and manage error!...
				}
				//_this.numToLoad--;
			})
		}
		getComptes();

		this.analytiques = [];
		this.idAnalytiques = {};

		function getAnalytiques(){
			var getParams = { type_element: 'analytique', visible: 'visible'};
			if( _this.selectedExercice ){
				getParams.id_exercice = _this.selectedExercice;
			}else if(document.getElementById('id_exercice')){
				getParams.id_exercice = document.getElementById('id_exercice').value;
			}

			$.getJSON( '/admin/compta/budgets', getParams, function(data){
				if(data && data.elements){
					var l = data.elements.length;
					var i, d; 
					var fields = {id: 'id', libelle: 'libelle', visible: 'visible',};
					for(i=0; i<l; i++){
						d = new Object();

						for(field in fields){
							d[fields[field]] = data.elements[i][field];
						}
						_this.idAnalytiques[d['id']] = i;
						_this.analytiques.push(d);
					}
					//_this.numToLoad--;
					_this.update();
				}else{
					// TODO: no data elements, get and manage error!...
				}
				//_this.numToLoad--;
			})
		}
		getAnalytiques();

		readURL(e) {
            if ($(e.currentTarget)[0].files) {
				var id = isEdit ? 'produit_photo_upload_' + _this.el.id : 'produit_photo_upload';
            	var reader = new FileReader();
	            reader.onload = function (e) {
	                $('.preview')
	                    .attr('src', e.currentTarget.result)
	                    .width(200)
	                    .height(200)
	            };
	            	
	            reader.readAsDataURL($('#' + id)[0].files[0]);
            }

        }

		saveProduit(e){
			e.fields = [
				'id_activite',
				'id_modele',
				'image_url',
				'libelle',
				'visible',
				'information_internet',
				'informations',
				'tarif',
				'conditions',
				'date_validite',
				'formule_participation_salarie',
				'formule_participation_ce',
				'formule_condition',
				'id_compte',
				'id_analytique',
				'id_compte_stock',
				'question_1',
				'question_2',
				'question_3',
				'question_4',
				'question_5',
				'question_6',
				'question_7',
				'question_8',
				'question_9',
				'question_10',
				'question_11',
				'question_12',
				'question_13',
				'question_14',
				'question_15',
				'gestion_lettre',
				'lettre',
				'participation',
				'type_participation',
				'montant_participation',
				'stock',
				'nombre_billets',
				'stock_restant',
				'stock_alerte',
				'stock_permanence',
				'alerte_permanence',
				'limite_montant',
				'condition_montant',
				'limite_quantite',
				'condition_quantite',
				'limite_commande',
				'condition_commande',
				'conditions_commande',
				'stock_vendu',
				'impression_automatique',
			];

			e.typeModele = 'bons_achats';

			if( isEdit ){
				e.item = _this.element;
			}

			_this.parentTag.saveProduit(e);
		    _this.unmount();
		}

		cancelProduit(e){
			if( isEdit ){
				e.item = _this.element;
			}
			_this.parentTag.cancelProduit(e);
		    _this.unmount();
		}

		disableElementById(e) {
		    _this.parentTag.E_M.disableElementById(e);
		}

		toggleFormule(e){
			$('#formule_container_cout').slideToggle();
			$('#formule_container_participation').slideToggle();
			$('#formule_container_condition').slideToggle();
		}

		formatDateField(e){
			e.preventDefault();
			e.preventUpdate = true;

			if(_this.parentTag.E_M){
				_this.parentTag.E_M.formatDateField({
					event: e
				});
			}
        }

        this.convertDateToDb = function convertDateToDb(date){
			if( _this.parentTag.E_M ){
				return _this.parentTag.E_M.convertDateToDb(date);
			}else{
				return false;
			}
        }

        this.convertDateToView = function convertDateToView(date){
			if( _this.parentTag.E_M ){
				return _this.parentTag.E_M.convertDateToView(date);
			}else{
				return false;
			}
		}

		function loadDateTemplate(id) {
			var suffixId = id ? '_' + id : '';
			var $date = $('#front_produit_date_validite' + suffixId);
			if($date) {
				$.datepicker.setDefaults( $.datepicker.regional[ "fr" ] );
				$date.datepicker({
			      dateFormat: 'dd/mm/yy',
			    });
				if($date.val() == ''){
			    	$date.datepicker( "setDate", new Date() );
				}
			}
		}

		this.on('mount', function(){
			if(_this.parentTag.E_M){

			}

			if(_this.parentTag.tinyMCE){
				tinyMCE.init({
					selector:'#produit_lettre' + ( isEdit && _this.element.id ? '_' + _this.element.id : '' ) + ', #produit_informations' + ( isEdit && _this.element.id ? '_' + _this.element.id : '' ),
					theme: "modern",
					language: 'fr_FR',
				    width: '98%',
				    height: 100,
					plugins: "textcolor link print",
	  				toolbar: ["forecolor | fontsizeselect | undo redo | bold italic underline | image | alignleft aligncenter alignright | link | print"],
					valid_elements: "@[class],p[style],span[style],h3,h4,h5,h6,a[href|target],strong/b,div[align],br",
					setup: function (editor) {
	        			editor.on('change', function () {
	            			editor.save();
	        			});
	    			}
				});
			}
			if( isEdit ){
				loadDateTemplate(_this.el.id);
			}else{
				loadDateTemplate();
			}
		});

		function getParametrages(){
            var getParams = {};

            $.getJSON('/admin/salaries/ayant_droit', getParams, function(data){
                if(data && data.element){
                    var i, field, d;
                    var fields = { id: 'id', nom: 'nom', prenom: 'prenom', titre: 'titre', id_salarie: 'id_salarie', date_de_naissance: 'date_de_naissance', genre: 'genre', lien: 'lien', type_lien: 'type_lien', option_1: 'option_1', option_2: 'option_2', option_3: 'option_3', option_4: 'option_4', option_5: 'option_5', option_6: 'option_6', option_7: 'option_7', option_8: 'option_8',    option_9: 'option_9', option_10: 'option_10', visible:'visible' };
                    if(data.element[0]) {
                        for(field in fields) {
                            _this.cell[fields[field]] = data.element[0][field];
                        }
                        Verification();
                    }
                    _this.update();
                    _this.loaded = true;
                }else{
                    // TODO: no data elements, get and manage error!...
                }
            });
        }
        getParametrages();


		function Verification(){
			var a = [];

			a.push({valeur:'option_1', libelle: (_this.cell.option_1 != '' ? _this.cell.option_1 : 'cl1') });
			a.push({valeur:'option_2', libelle: (_this.cell.option_2 != '' ? _this.cell.option_2 : 'cl2') });
			a.push({valeur:'option_3', libelle: (_this.cell.option_3 != '' ? _this.cell.option_3 : 'cl3') });
			a.push({valeur:'option_4', libelle: (_this.cell.option_4 != '' ? _this.cell.option_4 : 'cl4') });
			a.push({valeur:'option_5', libelle: (_this.cell.option_5 != '' ? _this.cell.option_5 : 'cl5') });
			a.push({valeur:'option_6', libelle: (_this.cell.option_6 != '' ? _this.cell.option_6 : 'cl6') });
			a.push({valeur:'option_7', libelle: (_this.cell.option_7 != '' ? _this.cell.option_7 : 'cl7') });
			a.push({valeur:'option_8', libelle: (_this.cell.option_8 != '' ? _this.cell.option_8 : 'cl8') });
			a.push({valeur:'option_9', libelle: (_this.cell.option_9 != '' ? _this.cell.option_9 : 'cl9') });
			a.push({valeur:'option_10', libelle: (_this.cell.option_10 != '' ? _this.cell.option_10 : 'cl10') });
		}

		filterChange (e) {
			e.preventDefault();
			e.preventUpdate = true;
			var fields = [ 'tranche_salaire','.quotient','statut','cl1','cl2','cl3','cl4','cl5','cl6','cl7','cl8','cl9','cl10'];
			var value = $(e.currentTarget).val();
			var l = fields.length;
			for(let i=0; i<l; i++){
				if( value == fields[i]){
					$('.' + value).show();
				}else{
					$('.' + value).hide();
				}
			}			
		}

		resetImage(){
        	$(".preview").attr('src','#');
        	$(".preview").hide();
        	$('#produit_photo_upload').val("");
		}
	</script>
</model-bons-achats>
