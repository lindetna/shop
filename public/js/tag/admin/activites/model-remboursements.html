<model-remboursements>
<!-- début produits ajout -->
	<div class="remboursement edit_remboursement">
		<div class="general" id="general">
			<div class="cell_1">
				<input id="produit_id_categorie{ isEdit ? '_' + el.id : '' }" name="produit_id_categorie{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentCategorieId }">
				<input id="produit_id_activite{ isEdit ? '_' + el.id : '' }" name="produit_id_activite{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentActiviteId }">
				<input id="produit_id_modele{ isEdit ? '_' + el.id : '' }" name="produit_id_modele{ isEdit ? '_' + el.id : '' }" type="hidden" value="{ parentTag.currentModeleId }">
				<!--
				<div id="image_upload">
					<input type="file" value="choisir une image" id="produit_photo_upload{ isEdit ? '_' + el.id : '' }" class="image_upload photo_add pointer" onchange={readURL} />
					<div class="image_position">
						<img class="preview" src="#"/>
					</div>
					<button id="reset_image" onclick={resetImage}>X</button>
					<input class="hidden" type="text" name="produit_image_url{ isEdit ? '_' + el.id : '' }" id="produit_image_url{ isEdit ? '_' + el.id : '' }">
				</div>
				-->
			</div>
			<div class="cell_2">
				<p>
					<label for="produit_categorie{ isEdit ? '_' + el.id : '' }" class="xl-large">Catégorie</label>
					<input id="produit_categorie{ isEdit ? '_' + el.id : '' }" name="produit_categorie{ isEdit ? '_' + el.id : '' }" type="text" disabled="disabled" value="{ parentTag.currentCategorieLibelle }">
				</p>
				<p>
					<label for="produit_activite{ isEdit ? '_' + el.id : '' }" class="xl-large">Activité</label>
					<input id="produit_activite{ isEdit ? '_' + el.id : '' }" name="produit_activite{ isEdit ? '_' + el.id : '' }" type="text" disabled="disabled" value="{ parentTag.currentActiviteLibelle }">
				</p>
				<p>
					<label for="produit_libelle{ isEdit ? '_' + el.id : '' }" class="xl-large">Libellé</label>
					<input id="produit_libelle{ isEdit ? '_' + el.id : '' }" name="produit_libelle{ isEdit ? '_' + el.id : '' }" class="" type="text" value="{ element.libelle }">
				</p>
			</div>
			<div class="cell_3">
				<input onclick={ parentTag.toggleVisible } type="image" class="produit_image_visible" src="/img/btn_{ element && element.visible == 'hidden' ? 'non' : '' }visible.png" title="visible" value="{ element && element.visible ? element.visible : 'visible' }" id="produit_visible{ isEdit ? '_' + el.id : '' }"  name="produit_visible{ isEdit ? '_' + el.id : '' }">
			</div>
		</div>
		<div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Informations
				</header>
				<div class="informations slide-up table">
					<div class="row">
						<div class="cell_1 ">
							<div class="block_infos">
								<span class="block_title">Internet</span>
								<div class="block_infos_content">
									<input type="checkbox" id="produit_information_internet{ isEdit ? '_' + el.id : '' }" name="produit_information_internet{ isEdit ? '_' + el.id : '' }" checked="{ element.information_internet ? 'checked' : '' }">Information Activité
									<input type="radio" id="produit_public_internet{ isEdit ? '_' + el.id : '' }" name="produit_public_internet{ isEdit ? '_' + el.id : '' }" value="1" checked="{ element.public_internet == '1' ? 'checked' : '' }">Public
									<input type="radio" id="produit_prive_internet{ isEdit ? '_' + el.id : '' }" name="produit_public_internet{ isEdit ? '_' + el.id : '' }" value="0" checked="{ element.public_internet == '0' ? 'checked' : '' }">Privé
								</div>
							</div>
						</div>
						<div class="cell_2 ">
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Tarifs / Conditions
				</header>
				<div class="tarifs_conditions slide-up table">
					<div class="row">
						<div class="cell_1">
							<div class="block_infos block_infos_1 condition_pce">
								<span class="block_title"  id="block_title"><input type="checkbox" id="produit_conditions{ isEdit ? '_' + el.id : '' }" name="produit_conditions{ isEdit ? '_' + el.id : '' }" checked="{ element.conditions == 1 ? 'checked' : '' }"> <span>Condition PCE</span></span>
								<div class="block_infos_content">
									<div class="sous_block_1">
										<label class="nombre">Nombre</label>
										<input class="right input_nbre" type="text" id="produit_limite_quantite{ isEdit ? '_' + el.id : '' }" name="produit_limite_quantite{ isEdit ? '_' + el.id : '' }" value={ element.limite_quantite }>
										<select class="select_date"  id="produit_condition_quantite{ isEdit ? '_' + el.id : '' }" name="produit_condition_quantite{ isEdit ? '_' + el.id : '' }">
											<option></option>
											<option value="mois" selected="{ 'selected': element.condition_quantite == 'mois' }">mois</option>
											<option value="trimestre" selected="{ 'selected': element.condition_quantite == 'trimestre' }">trimestre</option>
											<option value="semestre" selected="{ 'selected': element.condition_quantite == 'semestre' }">semestre</option>
											<option value="annee" selected="{ 'selected': element.condition_quantite == 'annee' }">année</option>
										</select>
										<select class="select_condition_famille"  id="produit_condition_famille{ isEdit ? '_' + el.id : '' }" name="produit_condition_famille{ isEdit ? '_' + el.id : '' }">
											<option></option>
											<option value="famille" selected="{ 'selected': element.condition_famille == 'famille' }">Toute la famille</option>
											<option value="salarie" selected="{ 'selected': element.condition_famille == 'salarie' }">Salarié</option>
											<option value="conjoint" selected="{ 'selected': element.condition_famille == 'conjoint' }">Conjoint(e)</option>
											<option value="enfants" selected="{ 'selected': element.condition_famille == 'enfants' }">Enfants</option>
										</select>
									</div>
									<div>
										<label for="produit_limite_places{ isEdit ? '_' + el.id : '' }">Limite montant</label>
										<input class="right input_nbre"  type="text" id="produit_limite_montant{ isEdit ? '_' + el.id : '' }" name="produit_limite_montant{ isEdit ? '_' + el.id : '' }" value="{ element.limite_montant }">
										<select class="select_date" class=" select_montant_limite" id="produit_condition_montant{ isEdit ? '_' + el.id : '' }" name="produit_condition_montant{ isEdit ? '_' + el.id : '' }">
											<option></option>
											<option value="mois" selected="{ 'selected': element.condition_montant == 'mois' }">mois</option>
											<option value="trimestre" selected="{ 'selected': element.condition_montant == 'trimestre' }">trimestre</option>
											<option value="semestre" selected="{ 'selected': element.condition_montant == 'semestre' }">semestre</option>
											<option value="annee" selected="{ 'selected': element.condition_montant == 'annee' }">année</option>
										</select>
									</div>
								</div>
							</div>
						</div>
						<div class="cell_2">
							<div class="block_infos block_infos_2">
								<span class="block_title"  id="block_title"><input type="checkbox" id="produit_participation{ isEdit ? '_' + el.id : '' }" name="produit_participation{ isEdit ? '_' + el.id : '' }" checked="{ element.participation == 1 ? 'checked' : '' }"> <span>Participation du CE</span></span>
								<div class="block_infos_content">
									<input type="radio" id="produit_type_participation{ isEdit ? '_' + el.id : '' }" name="produit_type_participation{ isEdit ? '_' + el.id : '' }" value="montant" checked="{ element.type_participation == 'montant' ? 'checked' : '' }">Montant
									<input type="radio" id="produit_type_participation_pourcentage{ isEdit ? '_' + el.id : '' }" name="produit_type_participation{ isEdit ? '_' + el.id : '' }" value="pourcentage" checked="{ element.type_participation == 'pourcentage' ? 'checked' : '' }">%
									<input type="text" class="input" id="produit_montant_participation{ isEdit ? '_' + el.id : '' }" name="produit_montant_participation{ isEdit ? '_' + el.id : '' }" value="{ element.montant_participation }">
								</div>
							</div>
						</div>
						<div class="cell_3">
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Formule
				</header>
				<div class="comptabilite Informations slide-up table">
					<div class="table Information_colonne">
						<div class="row">
							<div class="participation_salarie">
								<input type="checkbox" id-to-disable="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }" id="produit_is_formule_participation_ce{ isEdit ? '_' + el.id : '' }" name="produit_is_formule_participation_ce{ isEdit ? '_' + el.id : '' }" checked="{ element.formule_participation_ce ? 'checked' : '' }" class="Information_cheick" onclick="{ disableElementById }"><label>Participation CE</label><br>
								<textarea class="" id="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }" name="produit_formule_participation_ce{ isEdit ? '_' + el.id : '' }">{ element.formule_participation_ce }</textarea>
							</div>
						</div>
					</div>
				</div>
				<div class="comptabilite Informations slide-up table">
					<div class="table Information_colonne">
						<div class="row">
							<div class="participation_salarie">
								<input type="checkbox" id-to-disable="produit_formule_plafond{ isEdit ? '_' + el.id : '' }" id="produit_is_formule_plafond{ isEdit ? '_' + el.id : '' }" name="produit_is_formule_plafond{ isEdit ? '_' + el.id : '' }" checked="{ element.formule_plafond ? 'checked' : '' }" class="Information_cheick" onclick="{ disableElementById }"><label>Plafond</label><br>
								<textarea class="" id="produit_formule_plafond{ isEdit ? '_' + el.id : '' }" name="produit_formule_plafond{ isEdit ? '_' + el.id : '' }">{ element.formule_plafond }</textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Comptabilité
				</header>
				<div class="comptabilite slide-up table">
					<div class="table">
						<div class="row">
							<div class="cell_1">
								<div>
									<label for="produit_id_compte{ isEdit ? '_' + el.id : '' }" class="bold">Comptes </label>
									<select id="produit_id_compte{ isEdit ? '_' + el.id : '' }" name="produit_id_compte{ isEdit ? '_' + el.id : '' }">
										<option each={ comptes } value={ id } selected={ id == element.id_compte ? 'selected' : '' }>{ reference } - { libelle }</option>
									</select>
								</div>
								<div>
									<label for="produit_id_analytique{ isEdit ? '_' + el.id : '' }" class="bold">Analytique </label>
									<select id="produit_id_analytique{ isEdit ? '_' + el.id : '' }" name="produit_id_analytique{ isEdit ? '_' + el.id : '' }">
										<option each={ analytiques } value={ id } selected={ id == element.id_analytique ? 'selected' : '' }>{ libelle }</option>
									</select>
								</div>
								<div>
									<label for="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }" class="bold">Comptes de stock </label>
									<select id="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }" name="produit_id_compte_stock{ isEdit ? '_' + el.id : '' }">
										<option value="">-----------------</option>
										<option each={ comptes } value={ id } selected={ id == element.id_compte_stock ? 'selected' : '' }>{ reference } - { libelle }</option>
									</select>
								</div>
							</div>
							<div class="cell_1">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Questions
				</header>
				<div class="questions question_table slide-up table">
					<div class="table table_questions_categorie_activite">
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_1{ isEdit ? '_' + el.id : '' }" name="produit_is_question_1{ isEdit ? '_' + el.id : '' }" checked="{ element.question_1 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_1{ isEdit ? '_' + el.id : '' }" name="produit_question_1{ isEdit ? '_' + el.id : '' }" value="{ element.question_1 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_2{ isEdit ? '_' + el.id : '' }" name="produit_is_question_2{ isEdit ? '_' + el.id : '' }" checked="{ element.question_2 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_2{ isEdit ? '_' + el.id : '' }" name="produit_question_2{ isEdit ? '_' + el.id : '' }" value="{ element.question_2 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_3{ isEdit ? '_' + el.id : '' }" name="produit_is_question_3{ isEdit ? '_' + el.id : '' }" checked="{ element.question_3 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_3{ isEdit ? '_' + el.id : '' }" name="produit_question_3{ isEdit ? '_' + el.id : '' }" value="{ element.question_3 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_4{ isEdit ? '_' + el.id : '' }" name="produit_is_question_4{ isEdit ? '_' + el.id : '' }" checked="{ element.question_4 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_4{ isEdit ? '_' + el.id : '' }" name="produit_question_4{ isEdit ? '_' + el.id : '' }" value="{ element.question_4 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_5{ isEdit ? '_' + el.id : '' }" name="produit_is_question_5{ isEdit ? '_' + el.id : '' }" checked="{ element.question_5 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_5{ isEdit ? '_' + el.id : '' }" name="produit_question_5{ isEdit ? '_' + el.id : '' }" value="{ element.question_5 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_6{ isEdit ? '_' + el.id : '' }" name="produit_is_question_6{ isEdit ? '_' + el.id : '' }" checked="{ element.question_6 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_6{ isEdit ? '_' + el.id : '' }" name="produit_question_6{ isEdit ? '_' + el.id : '' }" value="{ element.question_6 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_7{ isEdit ? '_' + el.id : '' }" name="produit_is_question_7{ isEdit ? '_' + el.id : '' }" checked="{ element.question_7 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_7{ isEdit ? '_' + el.id : '' }" name="produit_question_7{ isEdit ? '_' + el.id : '' }" value="{ element.question_7 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_8{ isEdit ? '_' + el.id : '' }" name="produit_is_question_8{ isEdit ? '_' + el.id : '' }" checked="{ element.question_8 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_8{ isEdit ? '_' + el.id : '' }" name="produit_question_8{ isEdit ? '_' + el.id : '' }" value="{ element.question_8 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_9{ isEdit ? '_' + el.id : '' }" name="produit_is_question_9{ isEdit ? '_' + el.id : '' }" checked="{ element.question_9 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_9{ isEdit ? '_' + el.id : '' }" name="produit_question_9{ isEdit ? '_' + el.id : '' }" value="{ element.question_9 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_10{ isEdit ? '_' + el.id : '' }" name="produit_is_question_10{ isEdit ? '_' + el.id : '' }" checked="{ element.question_10 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_10{ isEdit ? '_' + el.id : '' }" name="produit_question_10{ isEdit ? '_' + el.id : '' }" value="{ element.question_10 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_11{ isEdit ? '_' + el.id : '' }" name="produit_is_question_11{ isEdit ? '_' + el.id : '' }" checked="{ element.question_11 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_11{ isEdit ? '_' + el.id : '' }" name="produit_question_11{ isEdit ? '_' + el.id : '' }" value="{ element.question_11 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_12{ isEdit ? '_' + el.id : '' }" name="produit_is_question_12{ isEdit ? '_' + el.id : '' }" checked="{ element.question_12 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_12{ isEdit ? '_' + el.id : '' }" name="produit_question_12{ isEdit ? '_' + el.id : '' }" value="{ element.question_12 }">
							</div>
						</div>
						<div class="row_table_questions_categorie_activite">
							<div class="cell_1">
								<input type="checkbox" id="produit_is_question_13{ isEdit ? '_' + el.id : '' }" name="produit_is_question_13{ isEdit ? '_' + el.id : '' }" checked="{ element.question_13 ? 'checked' : '' }">
							</div>
							<div class="cell_2">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_13{ isEdit ? '_' + el.id : '' }" name="produit_question_13{ isEdit ? '_' + el.id : '' }" value="{ element.question_13 }">
							</div>
							<div class="cell_3">
								<input type="checkbox" id="produit_is_question_14{ isEdit ? '_' + el.id : '' }" name="produit_is_question_14{ isEdit ? '_' + el.id : '' }" checked="{ element.question_14 ? 'checked' : '' }">
							</div>
							<div class="cell_4">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_14{ isEdit ? '_' + el.id : '' }" name="produit_question_14{ isEdit ? '_' + el.id : '' }" value="{ element.question_14 }">
							</div>
							<div class="cell_5">
								<input type="checkbox" id="produit_is_question_15{ isEdit ? '_' + el.id : '' }" name="produit_is_question_15{ isEdit ? '_' + el.id : '' }" checked="{ element.question_15 ? 'checked' : '' }">
							</div>
							<div class="cell_6">
								<input class="cell_questions_categorie_activite" type="text" id="produit_question_15{ isEdit ? '_' + el.id : '' }" name="produit_question_15{ isEdit ? '_' + el.id : '' }" value="{ element.question_15 }">
							</div>
						</div>
					</div>
				</div>
			</div>
			<div>
				<header class="opened titre" onclick="{ showContents }">
					Lettres
				</header>
				<div class="lettres categorie_table_lettres_activite slide-up table">
					<div class="left_right_lettres">
						<div class="left_block_lettres">
							<div class="titre_lettres">
								<span>Lettre</span>
								<div class="lettres_left_categ_act">
									<input type="checkbox" id="produit_gestion_lettre{ isEdit ? '_' + el.id : '' }" name="produit_gestion_lettre{ isEdit ? '_' + el.id : '' }" checked="{ element.gestion_lettre ? 'checked' : '' }">Gestion Lettre
									<input type="checkbox" id="produit_impression_automatique{ isEdit ? '_' + el.id : '' }" name="produit_impression_automatique{ isEdit ? '_' + el.id : '' }" checked="{ element.impression_automatique ? 'checked' : '' }">Impression Automatique
								</div>
							</div>
						</div>
						<div class="right_block_lettres">
							<select class="select_right_block_lettres" id="produit_lettre_fields{ isEdit ? '_' + el.id : '' }" name="produit_lettre_fields{ isEdit ? '_' + el.id : '' }">
								<option value="numero_salarie">N° { IS_CE ? 'Salarié' : 'Adhérent' }</option>
								<option value="titre">TItre</option>
								<option value="nom">Nom</option>
								<option value="prenom">Prénom</option>
								<option value="voie">N° et Voie</option>
								<option value="appartement_etage">N° Appartement ou Etage</option>
								<option value="entree_batiment">Entrée, Batiment</option>
								<option value="boite_postale">Lieu Dit, Boite Postale</option>
								<option value="code_postal">Code Postal</option>
								<option value="ville">Ville</option>
								<option value="pays">Pays</option>
								<option value="nom_naissance">Nom de Naissance</option>
								<option value="date_naissance">Date de Naissance</option>
								<option value="situation_familiale">Situation Familiale</option>
								<option value="tel">Téléphone</option>
								<option value="portable">Portable</option>
								<option value="email_perso">E-mail Personnel</option>
								<option value="email_pro">E-mail Professionel</option>
								<option value="id_internet">Identifiant Internet</option>
								<option value="pass">Mot de Passe</option>
								<option value="option_1">Option 1</option>
								<option value="option_2">Option 2</option>
							</select>
						</div>
					</div>
					<div class="lettre">
						<textarea class="lettre_texterea" id="produit_lettre{ isEdit ? '_' + el.id : '' }" name="produit_lettre{ isEdit ? '_' + el.id : '' }">{ element.lettre }</textarea>
					</div>
				</div>
			</div>
		</div>
		<div class="save_produit">
			<button class="button annuler cancel_submit" onclick={ cancelProduit }>Annuler</button> 
			<button class="button enregistrer save_submit" onclick={ saveProduit }>Enregistrer</button>
		</div>
	</div>
	<script>
		var _this = this;
		var app = opts.app;
		this.app = opts.app;
		this.parentTag = opts.parentTag;
		this.el = this.element = opts.element;
		this.loaded = false;
		var permissions = app.session.permissions;
		var ACTIVITES_READ = this.ACTIVITES_READ = permissions.ACTIVITES_READ || false;
		var IS_CE = this.IS_CE = permissions.IS_CE || false;
		var IS_ASSO = this.IS_ASSO = permissions.IS_ASSO || false;
		var element = this.el = this.element = opts.element;
		var isEdit = this.isEdit = false;

		if(opts.element){
			isEdit = this.isEdit = true;
		}else{
			element = this.el = this.element = {};
		}

console.log('remboursement mount element: ' + JSON.stringify(this.element));

		this.cell = {};

		this.comptes = [];
		this.idComptes = {};

		showContents(e){
			e.preventDefault();
			e.preventUpdate = true;
			e.stopPropagation();
            if(_this.parentTag.E_M){
                _this.parentTag.E_M.showContents(e, { toggleClass: 'hidden', });
            }
		}

		function getComptes(){
			var getParams = { type_element: 'compte' };
			if(document.getElementById('id_exercice')){
				getParams.id_exercice = document.getElementById('id_exercice').value;
			}
			getParams.visible = 'visible';
			$.getJSON( '/admin/compta/comptes', getParams, function(data){
				if(data && data.elements){
					var l = data.elements.length;
					var i, d; 
					var fields = {id: 'id', id_sous_classe: 'id_sous_classe',image_url: 'image_url', reference: 'reference', libelle: 'libelle', id_bilan_debit: 'id_bilan_debit', id_bilan_credit: 'id_bilan_credit', categorie_bilan_debit: 'categorie_bilan_debit', categorie_bilan_credit: 'categorie_bilan_credit', id_compte_resultat: 'id_compte_resultat', visible: 'visible',};
					var invisible_nb = 0;
					for(i=0; i<l; i++){
						if(data.elements[i]['visible'] === 'visible') {
							d = new Object();

							for(field in fields){
								d[fields[field]] = data.elements[i][field];
							}
							_this.idComptes[d['id']] = i - invisible_nb;
							_this.comptes.push(d);
						} else {
							invisible_nb += 1;
						}
					}
					//_this.numToLoad--;
					_this.update();
				}else{
					// TODO: no data elements, get and manage error!...
				}
				//_this.numToLoad--;
			})
		}
		getComptes();

		this.analytiques = [];
		this.idAnalytiques = {};

		function getAnalytiques(){
			var getParams = { type_element: 'analytique', visible: 'visible'};
			if( _this.selectedExercice ){
				getParams.id_exercice = _this.selectedExercice;
			}else if(document.getElementById('id_exercice')){
				getParams.id_exercice = document.getElementById('id_exercice').value;
			}

			$.getJSON( '/admin/compta/budgets', getParams, function(data){
				if(data && data.elements){
					var l = data.elements.length;
					var i, d; 
					var fields = {id: 'id', libelle: 'libelle', visible: 'visible',};
					for(i=0; i<l; i++){
						d = new Object();

						for(field in fields){
							d[fields[field]] = data.elements[i][field];
						}
						_this.idAnalytiques[d['id']] = i;
						_this.analytiques.push(d);
					}
					//_this.numToLoad--;
					_this.update();
				}else{
					// TODO: no data elements, get and manage error!...
				}
				//_this.numToLoad--;
			})
		}
		getAnalytiques();

		readURL(e) {
            if ($(e.currentTarget)[0].files) {
				var id = isEdit ? 'produit_photo_upload_' + _this.el.id : 'produit_photo_upload';
            	var reader = new FileReader();
	            reader.onload = function (e) {
	                $('.preview')
	                    .attr('src', e.currentTarget.result)
	                    .width(200)
	                    .height(200)
	            };
	            	
	            reader.readAsDataURL($('#' + id)[0].files[0]);
            }

        }

		saveProduit(e){
			e.fields = [
				'id_activite',
				'id_modele',
				'image_url',
				'libelle',
				'visible',
				'information_internet',
				'public_internet',
				'informations',

				'conditions',
				'limite_montant',
				'limite_quantite',
				'participation',
				'type_participation',
				'montant_participation',
				'formule_plafond',
				'formule_participation_ce',
				'id_compte',
				'id_analytique',
				'id_compte_stock',
				'question_1',
				'question_2',
				'question_3',
				'question_4',
				'question_5',
				'question_6',
				'question_7',
				'question_8',
				'question_9',
				'question_10',
				'question_11',
				'question_12',
				'question_13',
				'question_14',
				'question_15',
				'gestion_lettre',
				'condition_quantite',
				'condition_montant',
				'impression_automatique',
				'lettre',
				'condition_famille',
			];

			e.typeModele = 'remboursement';

			if( isEdit ){
				e.item = _this.element;
			}

			_this.parentTag.saveProduit(e);
			_this.unmount();
		}

		cancelProduit(e){
			if( isEdit ){
				e.item = _this.element;
			}
			_this.parentTag.cancelProduit(e);
			_this.unmount();
		}

		disableElementById(e) {
			_this.parentTag.E_M.disableElementById(e);
		}

		toggleFormule(e){
			$('#formule_container_cout').slideToggle();
			$('#formule_container_participation').slideToggle();
			$('#formule_container_condition').slideToggle();
		}

		formatDateField(e){
			e.preventDefault();
			e.preventUpdate = true;

			if(_this.parentTag.E_M){
				_this.parentTag.E_M.formatDateField({
					event: e
				});
			}
		}

		this.convertDateToDb = function convertDateToDb(date){
			if( _this.parentTag.E_M ){
				return _this.parentTag.E_M.convertDateToDb(date);
			}else{
				return false;
			}
		}

		this.convertDateToView = function convertDateToView(date){
			if( _this.parentTag.E_M ){
				return _this.parentTag.E_M.convertDateToView(date);
			}else{
				return false;
			}
		}

		this.on('mount', function(){
			if(_this.parentTag.E_M){

			}

			if(_this.parentTag.tinyMCE){
				tinyMCE.init({ 
					selector:'#produit_lettre' + ( isEdit && _this.element.id ? '_' + _this.element.id : '' ),
					theme: "modern",
					language: 'fr_FR',
					width: '98%',
					height: 100,
					plugins: "textcolor link print",
					toolbar: ["forecolor | fontsizeselect | undo redo | bold italic underline | image | alignleft aligncenter alignright | link | print"],
					valid_elements: "@[class],p[style],span[style],h3,h4,h5,h6,a[href|target],strong/b,div[align],br",
					setup: function (editor) {
						editor.on('change', function () {
							editor.save();
						});
					}
				});
			}
		});

		resetImage(){
        	$(".preview").attr('src','#');
        	$(".preview").hide();
        	$('#produit_photo_upload').val("");
		}
	</script>
</model-remboursements>
